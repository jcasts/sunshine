PidFile <%= expand_path pid %>
MaxClients <%= processes %>

<% if sudo == true || sudo == 'root' %>
User nobody
Group nobody
<% end %>

Listen <%= port %>

LoadModule log_config_module modules/mod_log_config.so
LoadModule authz_host_module modules/mod_authz_host.so

ErrorLog    <%= expand_path log_file(:stderr) %>
TransferLog <%= expand_path log_file(:stdout) %>

<% if use_passenger? %>
LoadModule passenger_module <%= passenger_root %>/ext/apache2/mod_passenger.so

PassengerRuby <%= shell.call "which ruby" %>
PassengerRoot <%= passenger_root %>
PassengerMaxPoolSize <%= processes %>
<% end %>

<% unless Sunshine::App === target %>
LoadModule proxy_module         modules/mod_proxy.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
LoadModule proxy_http_module    modules/mod_proxy_http.so
<% end %>

NameVirtualHost *:<%= port %>

<VirtualHost *:<%= port %>>
  ServerName  <%= server_name %>
  ServerAlias www.<%= server_name %>

  <% if Sunshine::App === target %>

  DocumentRoot <%= expand_path app.current_path %>/public

  <Directory <%= app.current_path %>/public>
      Allow from all
      Options -MultiViews
  </Directory>

  <% else %>

  ProxyPass / http://0.0.0.0:<%= target.port %>/
  ProxyPassReverse / http://0.0.0.0:<%= target.port %>/

  <% end %>
</VirtualHost>
